<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <title>New Script: SUSTC</title>

    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin"
          rel="stylesheet" type="text/css">
    <link href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" rel="stylesheet" type="text/css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- DEMO ONLY: Function for the proper stylesheet loading according to the demo settings -->
    <script>function _pxDemo_loadStylesheet(a, b, c) {
        var c = c || decodeURIComponent((new RegExp(";\\s*" + encodeURIComponent("px-demo-theme") + "\\s*=\\s*([^;]+)\\s*;", "g").exec(";" + document.cookie + ";") || [])[1] || "clean"),
            d = "rtl" === document.getElementsByTagName("html")[0].getAttribute("dir");
        document.write(a.replace(/^(.*?)((?:\.min)?\.css)$/, '<link href="$1' + (c.indexOf("dark") !== -1 && a.indexOf("/css/") !== -1 && a.indexOf("/themes/") === -1 ? "-dark" : "") + (!d || 0 !== a.indexOf("../css") && 0 !== a.indexOf("../demo") ? "" : ".rtl") + '$2" rel="stylesheet" type="text/css"' + (b ? 'class="' + b + '"' : "") + ">"))
    }</script>

    <!-- DEMO ONLY: Set RTL direction -->
    <script>"ltr" !== document.getElementsByTagName("html")[0].getAttribute("dir") && "1" === decodeURIComponent((new RegExp(";\\s*" + encodeURIComponent("px-demo-rtl") + "\\s*=\\s*([^;]+)\\s*;", "g").exec(";" + document.cookie + ";") || [])[1] || "0") && document.getElementsByTagName("html")[0].setAttribute("dir", "rtl");</script>

    <!-- DEMO ONLY: Load PixelAdmin core stylesheets -->
    <script>
        _pxDemo_loadStylesheet('../css/bootstrap.min.css', 'px-demo-stylesheet-bs');
        _pxDemo_loadStylesheet('../css/pixeladmin.min.css', 'px-demo-stylesheet-core');
        _pxDemo_loadStylesheet('../css/widgets.min.css', 'px-demo-stylesheet-widgets');
    </script>

    <!-- DEMO ONLY: Load theme -->
    <script>
        function _pxDemo_loadTheme(a) {
            var b = decodeURIComponent((new RegExp(";\\s*" + encodeURIComponent("px-demo-theme") + "\\s*=\\s*([^;]+)\\s*;", "g").exec(";" + document.cookie + ";") || [])[1] || "clean");
            _pxDemo_loadStylesheet(a + b + ".min.css", "px-demo-stylesheet-theme", b)
        }

        _pxDemo_loadTheme('../css/themes/');
    </script>

    <!-- Demo .. -->
    <script>_pxDemo_loadStylesheet('../demo/demo.css');</script>
    <!-- / Demo .. -->

    <!-- holder.js -->
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/holder/2.9.0/holder.js"></script>

    <!-- Pace.js -->
    <script src="../js/pace.min.js"></script>

    <script src="../demo/demo.js"></script>

    <!-- Custom styling -->
    <style>
        .page-header-form .input-group-addon,
        .page-header-form .form-control {
            background: rgba(0, 0, 0, .05);
        }
    </style>
    <!-- / Custom styling -->
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 0px;
            right: 0px;
            bottom: 0px;
            left: 0px;
        }
    </style>

</head>
<body>
<nav class="px-nav px-nav-left sidebar"></nav>

<nav class="navbar px-navbar">
    <!-- Header -->
    <div class="navbar-header">
        <a class="navbar-brand px-demo-brand" href="../index"><span class="px-demo-logo bg-primary"><span
                class="px-demo-logo-1"></span><span class="px-demo-logo-2"></span><span
                class="px-demo-logo-3"></span><span class="px-demo-logo-4"></span><span
                class="px-demo-logo-5"></span><span class="px-demo-logo-6"></span><span
                class="px-demo-logo-7"></span><span class="px-demo-logo-8"></span><span
                class="px-demo-logo-9"></span></span>SUSTC</a>
    </div>

    <!-- Navbar togglers -->
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#px-demo-navbar-collapse"
            aria-expanded="false"><i class="navbar-toggle-icon"></i></button>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="px-demo-navbar-collapse">
        <ul class="nav navbar-nav">
        </ul>

        <ul class="nav navbar-nav navbar-right">

            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                   aria-expanded="false">
                    <img src="demo/avatars/1.jpg" alt="" class="px-navbar-image">
                    <!--<span class="hidden-md">John Doe</span>-->
                    <span th:text="${user.username}" class="hidden-md">Anonymous</span>
                </a>
                <ul class="dropdown-menu">

                    <li><a href="/logout"><i class="dropdown-icon fa fa-power-off"></i>&nbsp;&nbsp;Log Out</a>
                    </li>
                </ul>
            </li>

        </ul>
    </div><!-- /.navbar-collapse -->
</nav>

<div class="px-content">
    <ol class="breadcrumb page-breadcrumb">
        <li><a href="/userHome">Home</a></li>
        <li class="active">Editing</li>
    </ol>

    <div class="page-header">
        <div class="row">
            <div class="col-md-4 text-xs-center text-md-left text-nowrap">
                <h1><i class="page-header-icon ion-ios-pulse-strong"></i>Editing</h1>
            </div>

            <hr class="page-wide-block visible-xs visible-sm">

            <!-- Spacer -->
            <div class="m-b-2 visible-xs visible-sm clearfix"></div>

        </div>
    </div>
    <div class="row">

        <form action="#" id="editorTextForm">
            <div class="col-md-9">
                <div class="panel clearfix text-default" style="height: 600px">
                    <input name="hiddenCode" type="text" hidden id="editorText" required>
                    <div id="editor" th:text="${currentContent}">function foo(items) {
                        var x = "Hello World!";
                        return x;
                        }
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel">
                    <div class="panel-heading">
                        <div class="panel-title">Editor Settings</div>
                    </div>
                    <div class="panel-body">
                        <table>
                            <tr>
                                <td style="text-align: center;padding:0 15px 30px 30px;"><span style="font-size: 14px;">Text Size:</span>
                                </td>
                                <td style="text-align: center;padding:0 0 30px 0;">
                                    <select class="custom-select form-control"
                                            onchange="{editor.setFontSize(this.value + 'px')};">
                                        <option value=12>12</option>
                                        <option value=14>14</option>
                                        <option value=16 selected="selected">16</option>
                                        <option value=18>18</option>
                                        <option value=20>20</option>
                                        <option value=22>22</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align: center;padding:0 15px 30px 30px;"><span style="font-size: 14px;">Theme:</span>
                                </td>
                                <td style="text-align: center;padding:0 0 30px 0;">
                                    <select id="editorType" class="custom-select form-control"
                                            onchange="{editor.setTheme('ace/theme/' + this.value);};">
                                        <option value="ambiance">ambiance</option>
                                        <option value="chaos">chaos</option>
                                        <option value="chrome" selected="selected">chrome</option>
                                        <option value="clouds_midnight">clouds_midnight</option>
                                        <option value="monokai">monokai</option>
                                        <option value="solarized_dark">solarized_dark</option>
                                        <option value="solarized_light">solarized_light</option>
                                        <option value="twilight">twilight</option>
                                        <option value="xcode">xcode</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align: center;padding:0 15px 0px 30px;"><span style="font-size: 14px;">Language:</span>
                                </td>
                                <td style="text-align: center;padding:0 0 0 0;">
                                    <select class="custom-select form-control"
                                            onchange="{
                                                editor.session.setMode('ace/mode/' + this.value);
                                                document.getElementById('type').value = this.value;
                                        }">
                                        <option value="javascript" selected="selected">javascript</option>
                                        <option value="python">python</option>
                                        <option value="php">php</option>
                                        <option value="perl">perl</option>
                                        <option value="ruby">ruby</option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-heading">
                        <div class="panel-title">Basic Information</div>
                    </div>
                    <div class="panel-body">
                        <input type="text" class="form-control" required th:name = "name" th:id = "name" th:value="${currentScript.name}" />
                        <br>
                        <select th:id="type" class="custom-select form-control"
                                onchange="{document.getElementById('editorType').value = this.value}">
                            <option value="javascript">javascript</option>
                            <option value="python">python</option>
                            <option value="php">php</option>
                            <option value="perl">perl</option>
                            <option value="ruby">ruby</option>
                        </select>
                        <br>
                        <textarea id="formDescription" class="form-control" rows="4" required th:name = "description" th:id = "description" th:text="${currentScript.description}" ></textarea>
                        <br>
                        <button type="submit" class="btn btn-md btn-primary btn-block">UPLOAD</button>
                        <!--<button type="button" onclick="updateScript()" class="btn btn-md btn-primary btn-block">UPLOAD</button>-->
                        <br>
                    </div>
                </div>
            </div>
        </form>



    </div>
</div>

<footer class="px-footer px-footer-bottom p-t-0">
    <br>
    <span class="text-muted">Copyright © 2018 PixelAdmin LLC. All rights reserved.</span>
</footer>

<script th:inline="javascript">
    document.getElementById("type").value = [[${currentScript.type.name}]];
    document.getElementById("editorType").value = [[${currentScript.type.name}]];
    var form = document.getElementById("editorTextForm");
    form.onsubmit = function(e) {
        e.preventDefault();
        updateScript();
    }

    function updateScript() {
        var name = document.getElementById("name").value;
        var type = document.getElementById("type").value;
        var description = document.getElementById("description").value;
        var content = editor.getValue();
        var postData = {
            "sid": [[${sid}]],
            "name": name,
            "type": type,
            "description": description,
            "file": content
        };
        $.post("/updateScriptText", postData, function (msg) {
            alert(msg);
            location.reload();
        });
    }
</script>

<!-- jQuery -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script src="../js/bootstrap.min.js"></script>
<script src="../js/pixeladmin.min.js"></script>
<script src="../js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/chrome");
    editor.session.setMode("ace/mode/javascript");
    editor.setFontSize("16px")

    document.getElementById("editorTextForm").onchange = function(evt) {
        document.getElementById("editorText").value = editor.getValue();
    }
</script>

<script>
  $('input[type="file"]').change(function(e){
    var fileName = e.target.files[0].name;
    console.log(fileName);
    document.getElementById("fileName").innerHTML = fileName;
  });
</script>

<script>
    // -------------------------------------------------------------------------
    // Initialize DEMO sidebar

    $(function () {
        pxDemo.initializeDemoSidebar();

        $('#px-demo-sidebar').pxSidebar();
        pxDemo.initializeDemo();
    });
</script>

<script type="text/javascript">
    // -------------------------------------------------------------------------
    // Initialize DEMO

    $(function () {
        $('.sidebar').load("sidebar.html");
        // $('.header').load("header.html");

        var file = String(document.location).split('/').pop();

        // Remove unnecessary file parts
        file = file.replace(/(\.html).*/i, '$1');

        if (!/.html$/i.test(file)) {
            file = 'index.html';
        }

        // Activate current nav item
        $('body > .px-nav')
            .find('.px-nav-item > a[href="' + file + '"]')
            .parent()
            .addClass('active');

        $('body > .px-nav').pxNav();
        $('body > .px-footer').pxFooter();

        $('#navbar-notifications').perfectScrollbar();
        $('#navbar-messages').perfectScrollbar();
    });
</script>
</body>
</html>